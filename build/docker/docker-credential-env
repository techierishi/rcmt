#!/usr/bin/env bash

# docker-credential-env
# 2018 - Jason Kohles

die() {
  echo "$@" 1>&2
  exit 1
}

if [ -z "$DOCKER_REGISTRY" ]; then die "DOCKER_REGISTRY not set in environment"; fi
case "$1" in
  get)
    read HOST
    if [ "$HOST" = "$DOCKER_REGISTRY" ]; then
      printf '{"ServerURL":"%s","Username":"%q","Secret":"%q"}\n' \
        "$HOST" "$DOCKER_CREDS_USR" "$DOCKER_CREDS_PSW"
    else
      die "No credentials available for $HOST"
    fi
    ;;
  *)
    die "Unsupported operation"
    ;;
esac
